<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Acervo Liter√°rio - Livros usados com qualidade de colecionador. Entrega na empresa.">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="theme-color" content="#1e3a5f">
    
    <title>Acervo Liter√°rio | Livros de Qualidade Direto para Voc√™</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231e3a5f' rx='12' width='100' height='100'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white' font-family='Georgia'>üìö</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-primary: #1e3a5f;
            --color-primary-light: #2d4a6f;
            --color-accent: #c9a227;
            --color-accent-hover: #b8922a;
            --color-success: #16a34a;
            --color-sold: #dc2626;
            --color-surface: #ffffff;
            --color-surface-elevated: #f5f0e8;
            --color-surface-warm: #faf7f2;
            --color-text: #2c2c2c;
            --color-text-muted: #5c5c5c;
            --color-border: #e0d9cf;
            --font-display: 'Crimson Pro', Georgia, serif;
            --font-body: 'DM Sans', system-ui, sans-serif;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --transition-fast: 150ms ease;
            --transition-normal: 300ms ease;
        }

        [data-theme="dark"] {
            --color-primary: #f0e6d3;
            --color-primary-light: #e0d6c3;
            --color-surface: #1a1a1a;
            --color-surface-elevated: #252525;
            --color-surface-warm: #1f1f1f;
            --color-text: #e8e8e8;
            --color-text-muted: #a0a0a0;
            --color-border: #3a3a3a;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        
        html, body { 
            overflow-x: hidden; 
            width: 100%;
            max-width: 100%;
            position: relative;
        }
        
        html { 
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent; 
            font-size: 16px; 
        }

        body {
            font-family: var(--font-body);
            background: var(--color-surface-warm);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .font-display { font-family: var(--font-display); }

        :focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--color-surface-elevated); }
        ::-webkit-scrollbar-thumb { background: var(--color-text-muted); border-radius: 4px; }

        /* ===== ANIMA√á√ïES ===== */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shimmer {
            0% { background-position: -400px 0; }
            100% { background-position: 400px 0; }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* ===== CARDS ===== */
        .book-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition-normal);
            opacity: 0;
            transform: translateY(20px);
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 100%; 
        }

        .book-card.visible { opacity: 1; transform: translateY(0); }

        .book-card:hover:not(.sold) {
            transform: translateY(-6px);
            box-shadow: var(--shadow-xl);
            border-color: var(--color-accent);
        }

        .book-card.sold { opacity: 0.7; pointer-events: none; }

        /* ===== TARJA VENDIDO ===== */
        .sold-badge {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .sold-badge span {
            background: var(--color-sold);
            color: white;
            padding: 0.75rem 2rem;
            font-size: 1.25rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transform: rotate(-15deg);
            box-shadow: var(--shadow-lg);
        }

        /* ===== IMAGEM ===== */
        .book-cover {
            position: relative;
            height: 15rem;
            overflow: hidden;
            background: linear-gradient(135deg, var(--color-border) 0%, var(--color-surface-elevated) 100%);
            flex-shrink: 0;
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.5s ease, transform var(--transition-normal);
        }

        .book-cover img.loaded { opacity: 1; }
        .book-card:hover .book-cover img { transform: scale(1.05); }

        .skeleton {
            background: linear-gradient(90deg, var(--color-border) 0%, var(--color-surface-elevated) 50%, var(--color-border) 100%);
            background-size: 800px 100%;
            animation: shimmer 1.5s infinite linear;
        }

        /* ===== PLACEHOLDER ===== */
        .cover-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(145deg, #e8e0d5 0%, #d4ccc0 100%);
            padding: 1rem;
            text-align: center;
        }

        .cover-placeholder i { font-size: 2.5rem; color: var(--color-primary); margin-bottom: 0.5rem; }
        .cover-placeholder span { font-size: 0.7rem; color: var(--color-text-muted); line-height: 1.3; font-weight: 500; }

        /* ===== TAGS DE G√äNERO ===== */
        .genre-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.375rem;
        }

        .genre-tag {
            display: inline-flex;
            align-items: center;
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background: var(--color-surface-elevated);
            color: var(--color-text-muted);
            border: 1px solid var(--color-border);
        }

        /* ===== FAVORITOS (CARD) ===== */
        .favorite-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: var(--color-surface);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transform: scale(0.8);
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-md);
            z-index: 10;
        }

        .book-card:hover .favorite-btn, .favorite-btn:focus, .favorite-btn.active { opacity: 1; transform: scale(1); }
        .favorite-btn i { font-size: 1rem; color: var(--color-text-muted); transition: all var(--transition-fast); }
        .favorite-btn.active i { color: #ef4444; }
        .favorite-btn:hover { transform: scale(1.1); background: var(--color-accent); }
        .favorite-btn:hover i { color: white; transform: scale(1.1); }

        /* ===== FILTROS COM NAVEGA√á√ÉO ===== */
        .filters-wrapper {
            position: relative;
            margin: 0;
            width: 100%;
        }

        .filters-container {
            overflow: hidden;
            position: relative;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .filters-container::-webkit-scrollbar { display: none; }

        .filters-scroll {
            display: flex;
            gap: 0.5rem;
            transition: transform var(--transition-normal);
            padding: 0.25rem 0;
            overflow-x: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
            touch-action: pan-x;
        }
        
        .filters-scroll::-webkit-scrollbar { display: none; }

        .filter-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        .filter-nav-btn:hover { background: var(--color-accent); color: white; border-color: var(--color-accent); transform: translateY(-50%) scale(1.1); }
        .filter-nav-btn.visible { display: flex; }
        .filter-nav-btn.prev { left: 0; }
        .filter-nav-btn.next { right: 0; }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
            font-weight: 500;
            border-radius: 9999px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text-muted);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
            flex-shrink: 0;
            touch-action: manipulation;
        }

        .filter-chip:hover { 
            border-color: var(--color-accent);
            color: var(--color-accent); 
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .filter-chip.active { 
            background: var(--color-primary);
            border-color: var(--color-primary); 
            color: white;
            transform: translateY(-2px);
        }
        .filter-chip .count { 
            font-size: 0.6875rem;
            padding: 0.125rem 0.375rem; 
            border-radius: 9999px; 
            background: rgba(0,0,0,0.1); 
        }
        .filter-chip.active .count { background: rgba(255,255,255,0.2); }

        /* ===== SEARCH ===== */
        .search-container { position: relative; }

        .search-container input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            font-size: 1rem;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text);
            transition: all var(--transition-fast);
            appearance: none;
            -webkit-appearance: none;
        }

        .search-container input:focus { 
            border-color: var(--color-accent);
            box-shadow: 0 0 0 4px rgba(201, 162, 39, 0.15); 
        }
        .search-container input::placeholder { color: var(--color-text-muted); }
        .search-container .search-icon { 
            position: absolute; 
            left: 1rem; 
            top: 50%; 
            transform: translateY(-50%);
            color: var(--color-text-muted); 
        }
        .search-container input:focus + .search-icon { color: var(--color-accent); }

        .search-container .clear-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            border: none;
            background: var(--color-border);
            color: var(--color-text-muted);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .search-container .clear-btn.visible { display: flex; }
        .search-container .clear-btn:hover { background: var(--color-accent); color: white; transform: translateY(-50%) scale(1.1); }

        /* ===== MODAIS ===== */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(30, 58, 95, 0.8);
            backdrop-filter: blur(4px);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal-backdrop.open { opacity: 1; visibility: visible; }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            max-width: 42rem;
            width: calc(100% - 2rem);
            max-height: calc(100vh - 2rem);
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            z-index: 51;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal-backdrop.open + .modal-content, .modal-content.open {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        /* CORRE√á√ÉO DO BOT√ÉO FECHAR E FAVORITAR (Intera√ß√£o Mobile) */
        .modal-close, #modalFavoriteBtn {
            cursor: pointer;
            transition: background-color 0.15s ease, color 0.15s ease, transform 0.15s ease;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: none;
            background: var(--color-surface);
            color: var(--color-text);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            z-index: 52;
        }

        .modal-close:hover, .modal-close:active { 
            background: var(--color-sold) !important;
            color: white !important;
            transform: rotate(90deg) scale(1.1); 
        }

        #modalFavoriteBtn:hover, #modalFavoriteBtn:active {
            background: var(--color-accent) !important;
            transform: scale(1.1);
        }
        #modalFavoriteBtn:hover i, #modalFavoriteBtn:active i {
            color: white !important;
        }

        /* ===== DESCRI√á√ÉO ESTILIZADA ===== */
        .book-description {
            font-size: 0.9375rem;
            line-height: 1.8;
            color: var(--color-text);
        }

        .book-description .highlight {
            background: linear-gradient(180deg, transparent 60%, rgba(201, 162, 39, 0.3) 60%);
            font-weight: 600;
        }

        .book-description .section {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px dashed var(--color-border);
        }

        .book-description .section:last-child { 
            border-bottom: none;
            margin-bottom: 0; 
            padding-bottom: 0; 
        }

        .book-description .label {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-accent);
            margin-bottom: 0.5rem;
        }

        /* ===== TOAST ===== */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            pointer-events: none;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: var(--color-primary);
            color: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            animation: slideInRight 0.3s ease-out;
            pointer-events: auto;
        }

        .toast.success { background: var(--color-success); }

        /* ===== SCROLL TO TOP ===== */
        .scroll-to-top {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: var(--color-primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transform: translateY(1rem);
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-lg);
            z-index: 40;
        }

        .scroll-to-top.visible { opacity: 1; visibility: visible; transform: translateY(0); }
        .scroll-to-top:hover { 
            transform: translateY(-4px) scale(1.1);
            background: var(--color-accent);
        }

        /* ===== NAVBAR ===== */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 40;
            background: var(--color-primary);
            color: white;
            transition: all var(--transition-normal);
            width: 100%;
        }

        .navbar.scrolled { box-shadow: var(--shadow-lg); }

        /* ===== WHATSAPP BUTTON ===== */
        .whatsapp-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            text-decoration: none;
            transition: all var(--transition-fast);
            box-shadow: 0 4px 14px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn:hover { 
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4); 
        }

        /* ===== PRICE TAG ===== */
        .price-tag { font-size: 1.75rem; font-weight: 700; color: var(--color-accent); }
        .price-tag small { font-size: 1rem; font-weight: 500; color: var(--color-text-muted); }
        
        .price-original { 
            font-size: 0.85rem;
            color: var(--color-text-muted); 
            text-decoration: line-through; 
            display: block; 
            line-height: 1.2; 
        }
        .discount-badge { 
            background-color: rgba(22, 163, 74, 0.1);
            color: var(--color-success); 
            font-size: 0.7rem; 
            padding: 0.1rem 0.4rem; 
            border-radius: 9999px; 
            font-weight: 700; 
            margin-left: 0.3rem; 
            vertical-align: middle;
        }
        .current-price-green { color: var(--color-success); font-weight: 700; }

        /* ===== THEME TOGGLE ===== */
        .theme-toggle {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
            background: transparent;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .theme-toggle:hover { background: rgba(255,255,255,0.1); transform: scale(1.1); }

        /* ===== EMPTY STATE ===== */
        .empty-state { 
            text-align: center;
            padding: 4rem 2rem; 
            animation: fadeInUp 0.5s ease-out; 
        }
        .empty-state i { 
            font-size: 4rem;
            color: var(--color-border); 
            margin-bottom: 1.5rem; 
        }

        /* ===== PAYMENT INFO ===== */
        .payment-method {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: var(--color-surface-elevated);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
        }

        .payment-method i { font-size: 1.5rem; color: var(--color-accent); margin-top: 0.25rem; }
        .payment-method h4 { font-weight: 600; color: var(--color-primary); margin-bottom: 0.25rem; }
        .payment-method p { font-size: 0.875rem; color: var(--color-text-muted); line-height: 1.5; }

        /* ===== BOT√ïES COM HOVER ===== */
        button, .btn { transition: all var(--transition-fast); }
        button:hover:not(:disabled), .btn:hover { transform: translateY(-2px); }

        .modal-content button:not(.modal-close):not(.favorite-btn):hover {
            font-weight: 600;
            background: var(--color-accent-hover) !important;
        }

        /* ===== MOBILE MENU & NAVBAR CORRECTIONS ===== */
        .mobile-menu-btn {
            display: none;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(255,255,255,0.3);
            background: transparent;
            color: white;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            z-index: 50; /* Garante que o bot√£o esteja clic√°vel */
        }

        .mobile-menu-btn:active, .mobile-menu-btn:hover { background: rgba(255,255,255,0.1); }

        /* REGRA ESPEC√çFICA PARA O MENU MOBILE (Sem depender de Tailwind) */
        #mobileMenu {
            display: none; /* Escondido por padr√£o */
        }
        
        #mobileMenu.menu-open {
            display: block !important; /* For√ßa a exibi√ß√£o quando a classe existir */
        }

        @media (max-width: 768px) {
            .mobile-menu-btn { display: flex; }
            .desktop-nav { display: none; }
            
            /* Ajustes Hero e Cards */
            .hero-title { font-size: 1.75rem !important; line-height: 1.2 !important; }
            .hero-subtitle { font-size: 0.9375rem !important; }
            .hero-checks { font-size: 0.75rem !important; gap: 0.75rem !important; }
            .book-cover { height: 13rem; }
            .book-card { min-height: auto; }
            .genre-tag { font-size: 0.5625rem; padding: 0.1875rem 0.375rem; }
            
            .favorite-btn { 
                width: 2.5rem; height: 2.5rem; top: 0.5rem; right: 0.5rem; opacity: 1; transform: scale(1);
            }
            .favorite-btn i { font-size: 1rem; }
            
            .filter-chip { padding: 0.625rem 1rem; font-size: 0.875rem; min-height: 2.5rem; }
            .filter-chip .count { font-size: 0.75rem; }
            
            .search-container input { padding: 1.125rem 1rem 1.125rem 3.25rem; font-size: 1rem; }
            .search-container .search-icon { font-size: 1.125rem; left: 1.125rem; }
            .search-container .clear-btn { width: 1.75rem; height: 1.75rem; }
            
            .whatsapp-btn { padding: 1.125rem 1.5rem; font-size: 1.0625rem; }
            
            /* Modal Fixes */
            .modal-content {
                top: auto; bottom: 0; left: 0; right: 0;
                transform: translateY(100%);
                max-width: 100%; width: 100%; max-height: 85vh; height: auto;
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
                display: flex; flex-direction: column;
                padding-bottom: env(safe-area-inset-bottom);
            }
            .modal-backdrop.open + .modal-content, .modal-content.open { transform: translateY(0); }
            
            .modal-content .md\:w-5\/12 { height: 12rem !important; flex-shrink: 0; }
            
            .modal-close {
                width: 2.5rem; height: 2.5rem; top: 0.75rem; right: 0.75rem; left: auto;
                background: rgba(255,255,255,0.9); color: #000; z-index: 60;
            }
            
            #modalFavoriteBtn {
                top: 0.75rem; left: 0.75rem; right: auto; z-index: 60;
                background: rgba(255,255,255,0.9);
            }
            
            .book-description { font-size: 0.9375rem; line-height: 1.7; }
            .book-description .label { font-size: 0.6875rem; }
            
            .toast-container { left: 1rem; right: 1rem; bottom: 5rem; }
            .toast { width: 100%; font-size: 0.9375rem; }
            
            .scroll-to-top { bottom: 5rem; width: 3rem; height: 3rem; margin-bottom: env(safe-area-inset-bottom); }
            .scroll-to-top i { font-size: 1.125rem; }
            
            .py-12 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
            .py-16 { padding-top: 2.5rem !important; padding-bottom: 2.5rem !important; }
            #bookGrid { gap: 1rem; }
        }

        @media (max-width: 375px) {
            .hero-title { font-size: 1.5rem !important; }
            .book-cover { height: 11rem; }
            .filter-chip { padding: 0.5rem 0.875rem; font-size: 0.8125rem; }
            #bookGrid { grid-template-columns: 1fr; }
        }

        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .sr-only { 
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; 
            overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; 
        }

        @media print {
            .navbar, .scroll-to-top, .toast-container, .favorite-btn { display: none !important; }
            .book-card { break-inside: avoid; }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="sr-only focus:not-sr-only">Pular para o conte√∫do</a>

    <nav class="navbar" role="navigation">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 sm:h-20">
                <a href="#" class="flex items-center gap-3">
                    <div class="h-11 w-11 bg-white/10 backdrop-blur text-white flex items-center justify-center rounded-lg text-2xl shrink-0">
                        üìö
                    </div>
                    <div>
                        <p class="font-bold text-lg leading-none text-white">Acervo Liter√°rio</p>
                        <p class="text-xs text-white/70 mt-0.5">Cole√ß√µes de qualidade</p>
                    </div>
                </a>

                <div class="desktop-nav flex items-center gap-3">
                    <button onclick="openHowItWorks()" class="text-sm font-medium px-4 py-2 rounded-lg transition text-white/80 hover:text-white hover:bg-white/10 hover:font-semibold">
                        <i class="fas fa-info-circle mr-2"></i>Como Comprar
                    </button>
                    <button onclick="openPaymentInfo()" class="text-sm font-medium px-4 py-2 rounded-lg transition text-white/80 hover:text-white hover:bg-white/10 hover:font-semibold">
                        <i class="fas fa-credit-card mr-2"></i>Pagamento
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Alternar tema">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <a href="https://wa.me/5547991438831" target="_blank" rel="noopener noreferrer" class="bg-white/20 hover:bg-white/30 text-white px-5 py-2.5 rounded-lg text-sm font-medium flex items-center gap-2 transition backdrop-blur hover:scale-105">
                        <i class="fab fa-whatsapp"></i> Falar Comigo
                    </a>
                </div>

                <div class="flex items-center gap-2 md:hidden">
                    <!-- BOT√ÉO COMO COMPRAR AJUSTADO (MENOR) -->
                    <button onclick="openHowItWorks()" class="bg-white/10 hover:bg-white/20 text-white px-2 py-1 rounded-md transition flex items-center gap-1.5 text-[10px] font-medium leading-none">
                        <i class="fas fa-info-circle text-[10px]"></i>
                        <span>Como Comprar</span>
                    </button>
                    
                    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="mobileMenu" class="bg-[#162d4b] border-t border-white/10">
            <div class="px-4 py-4 space-y-2">
                <button onclick="openPaymentInfo(); toggleMobileMenu();" class="w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-white hover:bg-white/10 transition">
                    <i class="fas fa-credit-card text-white/70"></i> Pagamento
                </button>
                
                <button onclick="toggleTheme(); toggleMobileMenu();" class="w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-white hover:bg-white/10 transition">
                    <i class="fas fa-moon" id="themeIconMobile"></i> Alternar Tema
                </button>
                
                <a href="https://wa.me/5547991438831" target="_blank" rel="noopener noreferrer" class="w-full px-4 py-3 rounded-lg flex items-center justify-center gap-2 bg-green-600 text-white font-medium hover:bg-green-700 transition mt-2">
                    <i class="fab fa-whatsapp"></i> Falar Comigo
                </a>
            </div>
        </div>
    </nav>

    <div class="bg-gradient-to-br from-[var(--color-primary)] via-[var(--color-primary-light)] to-[#2a5080] text-white py-12 sm:py-16 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <div class="absolute top-10 left-10 text-6xl">üìñ</div>
            <div class="absolute top-20 right-20 text-4xl">‚ú®</div>
            <div class="absolute bottom-10 left-1/4 text-5xl">üìö</div>
            <div class="absolute bottom-20 right-10 text-3xl">üé≠</div>
        </div>
        <div class="max-w-7xl mx-auto px-4 text-center relative z-10">
            <h1 class="hero-title font-display text-4xl sm:text-5xl lg:text-6xl font-bold mb-4 leading-tight">
                Sua Pr√≥xima Grande <span class="text-[var(--color-accent)]">Aventura</span><br class="hidden sm:inline"/> Come√ßa Aqui
            </h1>
            <p class="hero-subtitle text-lg sm:text-xl text-white/90 max-w-3xl mx-auto mb-6">
                Livros cuidadosamente selecionados, com qualidade de colecionador.<br class="hidden sm:inline"/>
                <strong>Entrega personalizada</strong> na sua mesa em at√© 24h ap√≥s confirma√ß√£o.
            </p>
            <div class="hero-checks flex flex-wrap justify-center gap-4 sm:gap-6 text-sm sm:text-base">
                <div class="flex items-center gap-2">
                    <i class="fas fa-check-circle text-[var(--color-accent)]"></i>
                    <span>Estado Impec√°vel</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-check-circle text-[var(--color-accent)]"></i>
                    <span>Pre√ßos Justos</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-check-circle text-[var(--color-accent)]"></i>
                    <span>Entrega R√°pida</span>
                </div>
            </div>
        </div>
    </div>

    <main id="main-content" class="max-w-7xl mx-auto px-4 py-6 sm:py-10">
        <header class="mb-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <p id="counter" class="text-sm font-medium" style="color: var(--color-text-muted);" aria-live="polite">Carregando...</p>
                </div>
                <div class="flex items-center gap-3 w-full sm:w-auto">
                    <button id="favoritesFilter" onclick="toggleFavoritesFilter()" class="filter-chip flex-1 sm:flex-initial" aria-pressed="false">
                        <i class="fas fa-heart text-red-500"></i>
                        <span>Favoritos</span>
                        <span class="count" id="favoritesCount">0</span>
                    </button>
                    <div class="flex items-center gap-2 px-3 py-2 rounded-lg border flex-1 sm:flex-initial" style="background: var(--color-surface); border-color: var(--color-border);">
                        <i class="fas fa-sort text-xs" style="color: var(--color-text-muted);"></i>
                        <select id="sortSelect" onchange="renderBooks()" class="bg-transparent text-sm font-medium outline-none cursor-pointer w-full" style="color: var(--color-text);">
                            <option value="default">Relev√¢ncia</option>
                            <option value="price-asc">Menor Pre√ßo</option>
                            <option value="price-desc">Maior Pre√ßo</option>
                            <option value="alpha">A - Z</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <div class="search-container mb-6">
            <input type="search" id="searchInput" placeholder="Pesquise por t√≠tulo, g√™nero ou autor..." autocomplete="off">
            <i class="fas fa-search search-icon"></i>
            <button class="clear-btn" id="clearSearch" onclick="clearSearch()" aria-label="Limpar">
                <i class="fas fa-times text-xs"></i>
            </button>
        </div>

        <div class="filters-wrapper mb-8">
            <button class="filter-nav-btn prev" id="filterPrev" onclick="scrollFilters(-1)" aria-label="Anterior">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="filters-container">
                <div id="genreFilters" class="filters-scroll"></div>
            </div>
            <button class="filter-nav-btn next" id="filterNext" onclick="scrollFilters(1)" aria-label="Pr√≥ximo">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div id="bookGrid" class="grid grid-cols-1 min-[375px]:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-6" role="list"></div>

        <div id="emptyState" class="empty-state hidden">
            <i class="fas fa-search"></i>
            <h2 class="text-xl font-bold mb-2" style="color: var(--color-primary);">Nenhum livro encontrado</h2>
            <p style="color: var(--color-text-muted);">Tente ajustar os filtros ou buscar por outros termos.</p>
            <button onclick="clearAllFilters()" class="mt-4 px-6 py-2 rounded-lg font-medium transition text-white hover:scale-105" style="background: var(--color-accent);">
                Limpar filtros
            </button>
        </div>
    </main>

    <footer class="py-8 mt-12 border-t" style="border-color: var(--color-border); background: var(--color-surface);">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm" style="color: var(--color-text-muted);">
                <i class="fas fa-book-reader mr-2"></i>
                Acervo Liter√°rio &copy; <span id="currentYear"></span> ‚Äî Rodrigo Hang ‚Äî Gaspar, SC
            </p>
            <p class="text-xs mt-2" style="color: var(--color-text-muted);">
                Livros usados com qualidade ‚Ä¢ Entrega na empresa
            </p>
        </div>
    </footer>

    <div id="modalBackdrop" class="modal-backdrop" onclick="closeModal()"></div>
    <div id="modal" class="modal-content" role="dialog" aria-modal="true">
        <button class="modal-close" onclick="closeModal()" aria-label="Fechar">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="flex flex-col md:flex-row h-full md:max-h-[85vh] overflow-hidden">
            <div class="md:w-5/12 h-64 md:h-auto shrink-0 relative" style="background: var(--color-surface-elevated);">
                <img id="modalImg" class="w-full h-full object-cover" alt="">
                <button id="modalFavoriteBtn" class="favorite-btn" style="opacity: 1; transform: scale(1);">
                    <i class="far fa-heart"></i>
                </button>
            </div>
            
            <div class="md:w-7/12 p-6 sm:p-8 flex flex-col overflow-y-auto">
                <div id="modalGenreTags" class="genre-tags mb-3"></div>
                <h2 id="modalTitle" class="font-display text-2xl sm:text-3xl font-bold mb-4" style="color: var(--color-primary);"></h2>
                
                <div class="price-tag mb-6" id="modalPriceContainer"></div>
                
                <div class="book-description mb-6 flex-grow" id="modalDesc"></div>
                
                <a id="modalWhatsapp" href="#" target="_blank" rel="noopener noreferrer" class="whatsapp-btn mt-auto">
                    <i class="fab fa-whatsapp text-lg"></i>
                    <span>Quero Comprar</span>
                </a>
            </div>
        </div>
    </div>

    <div id="paymentBackdrop" class="modal-backdrop" onclick="closePaymentInfo()"></div>
    <div id="paymentModal" class="modal-content" style="max-width: 28rem; max-height: auto; overflow-y: auto;" role="dialog" aria-modal="true">
        <div class="p-6 sm:p-8">
            <h2 class="font-display text-2xl font-bold mb-6 text-center" style="color: var(--color-primary);">
                <i class="fas fa-wallet mr-2" style="color: var(--color-accent);"></i>
                Formas de Pagamento
            </h2>
            
            <div class="payment-method">
                <i class="fas fa-qrcode"></i>
                <div>
                    <h4>Pix</h4>
                    <p>Transfer√™ncia instant√¢nea. Ap√≥s copiar a chave, me envie o comprovante pelo WhatsApp.</p>
                    <button onclick="copyPix()" class="mt-2 text-sm font-semibold flex items-center gap-2 hover:underline transition" style="color: var(--color-accent);">
                        <i class="fas fa-copy"></i> Copiar chave: 58242143000190
                    </button>
                </div>
            </div>
            
            <div class="payment-method">
                <i class="fas fa-money-bill-wave"></i>
                <div>
                    <h4>Dinheiro</h4>
                    <p>Pagamento em esp√©cie no momento da entrega do livro na sua mesa.</p>
                </div>
            </div>
            
            <div class="payment-method">
                <i class="fas fa-credit-card"></i>
                <div>
                    <h4>Cart√£o (D√©bito/Cr√©dito)</h4>
                    <p><strong>Importante:</strong> Preciso levar a maquininha at√© a empresa. Me avise com anteced√™ncia para ter o equipamento dispon√≠vel no dia da entrega.</p>
                </div>
            </div>

            <div class="mt-6 p-4 rounded-lg text-center text-sm" style="background: rgba(201, 162, 39, 0.1); color: var(--color-text);">
                <i class="fas fa-lightbulb mr-2" style="color: var(--color-accent);"></i>
                O pagamento confirma sua reserva e garante o livro!
            </div>
            
            <button onclick="closePaymentInfo()" class="w-full mt-6 py-3 rounded-lg font-medium transition hover:font-semibold" style="background: var(--color-primary); color: white;">
                Entendi
            </button>
        </div>
    </div>

    <div id="howItWorksBackdrop" class="modal-backdrop" onclick="closeHowItWorks()"></div>
    <div id="howItWorksModal" class="modal-content" style="max-width: 28rem; max-height: auto; overflow-y: auto;" role="dialog" aria-modal="true">
        <div class="p-6 sm:p-8">
            <h2 class="font-display text-2xl font-bold mb-8 text-center" style="color: var(--color-primary);">
                <i class="fas fa-shopping-bag mr-2" style="color: var(--color-accent);"></i>
                Como Comprar
            </h2>
            
            <ol class="space-y-6 relative">
                <div class="absolute left-4 top-8 bottom-8 w-0.5" style="background: var(--color-border);"></div>
                
                <li class="flex gap-4 relative">
                    <div class="h-8 w-8 rounded-full flex items-center justify-center font-bold text-sm shrink-0 shadow-sm z-10 text-white" style="background: var(--color-accent);">1</div>
                    <div>
                        <h3 class="font-bold" style="color: var(--color-primary);">Escolha o livro</h3>
                        <p class="text-sm mt-1" style="color: var(--color-text-muted);">Navegue pelo cat√°logo e clique em "Quero Comprar" para me chamar no WhatsApp.</p>
                    </div>
                </li>
                
                <li class="flex gap-4 relative">
                    <div class="h-8 w-8 rounded-full flex items-center justify-center font-bold text-sm shrink-0 shadow-sm z-10 text-white" style="background: var(--color-success);">2</div>
                    <div>
                        <h3 class="font-bold" style="color: var(--color-primary);">Combine o pagamento</h3>
                        <p class="text-sm mt-1" style="color: var(--color-text-muted);">Pix, dinheiro ou cart√£o. O pagamento garante sua reserva.</p>
                    </div>
                </li>
                
                <li class="flex gap-4 relative">
                    <div class="h-8 w-8 rounded-full flex items-center justify-center font-bold text-sm shrink-0 shadow-sm z-10 text-white" style="background: var(--color-primary);">3</div>
                    <div>
                        <h3 class="font-bold" style="color: var(--color-primary);">Receba na sua mesa</h3>
                        <p class="text-sm mt-1" style="color: var(--color-text-muted);">Entrego pessoalmente no dia √∫til seguinte ao pagamento.</p>
                    </div>
                </li>
            </ol>
            
            <button onclick="closeHowItWorks()" class="w-full mt-8 py-3 rounded-lg font-medium transition hover:font-semibold" style="background: var(--color-primary); color: white;">
                Vamos l√°!
            </button>
        </div>
    </div>

    <div id="toastContainer" class="toast-container" aria-live="polite"></div>

    <button class="scroll-to-top" id="scrollToTop" onclick="scrollToTop()" aria-label="Voltar ao topo">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        const books = [
            { t: "Box Machado de Assis - Cole√ß√£o Completa", g: ["Cl√°ssicos", "Literatura Brasileira"], p: "145,00", v: 145, op: 289.00, q: "box machado de assis obra completa capa dura", d: "Oportunidade para sua biblioteca pessoal!\n\nVendo Box Premium do mestre Machado de Assis, contendo 11 obras cl√°ssicas em edi√ß√µes luxuosas com capa dura.\n\nOs livros est√£o impec√°veis, praticamente intocados, sem marcas de uso, dobras ou grifos ‚Äî ideais para quem busca qualidade de colecionador.\n\nüìö Conte√∫do do Box:\n‚Ä¢ Dom Casmurro\n‚Ä¢ Mem√≥rias P√≥stumas de Br√°s Cubas\n‚Ä¢ Quincas Borba\n‚Ä¢ Helena\n‚Ä¢ Iai√° Garcia\n‚Ä¢ Ressurrei√ß√£o\n‚Ä¢ A M√£o e a Luva\n‚Ä¢ Esa√∫ e Jac√≥\n‚Ä¢ Memorial de Aires\n‚Ä¢ Pap√©is Avulsos\n‚Ä¢ V√°rias Hist√≥rias\n\n‚ú® B√¥nus: Biografia detalhada do autor.\n\nüì∏ Posso encaminhar fotos reais e tirar qualquer d√∫vida por chat.", img: "https://images.tcdn.com.br/img/img_prod/1323385/box_machado_de_assis_11_livros_capa_dura_biografia_do_autor_17958_2_01d68758960ec216bd68b4445a9ed3ff.jpg" }
        ];

        // ===== ESTADO =====
        let favorites = JSON.parse(localStorage.getItem('seboFavorites') || '[]');
        let activeGenres = [];
        let showOnlyFavorites = false;
        let currentTheme = localStorage.getItem('seboTheme') || 'light';
        let filterScrollPos = 0;

        // ===== ELEMENTOS =====
        const grid = document.getElementById('bookGrid');
        const counter = document.getElementById('counter');
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearch');
        const emptyState = document.getElementById('emptyState');
        const scrollToTopBtn = document.getElementById('scrollToTop');
        const genreFiltersContainer = document.getElementById('genreFilters');

        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            applyTheme(currentTheme);
            renderGenreFilters();
            renderBooks();
            updateFavoritesCount();
            setupEventListeners();
        });

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                clearSearchBtn.classList.toggle('visible', searchInput.value.length > 0);
                searchTimeout = setTimeout(renderBooks, 150);
            });

            window.addEventListener('scroll', () => {
                const navbar = document.querySelector('.navbar');
                navbar.classList.toggle('scrolled', window.scrollY > 10);
                scrollToTopBtn.classList.toggle('visible', window.scrollY > 400);
            }, { passive: true });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    closePaymentInfo();
                    closeHowItWorks();
                    const menu = document.getElementById('mobileMenu');
                    if (menu) menu.classList.remove('menu-open');
                }
            });

            window.addEventListener('resize', updateFilterNavigation);
        }

        // ===== TEMA =====
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
            localStorage.setItem('seboTheme', currentTheme);
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const icon = theme === 'dark' ? 'fa-sun' : 'fa-moon';
            document.getElementById('themeIcon').className = `fas ${icon}`;
            const mobileIcon = document.getElementById('themeIconMobile');
            if (mobileIcon) mobileIcon.className = `fas ${icon}`;
        }

        // ===== NORMALIZA√á√ÉO =====
        function normalizeText(text) {
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        }

        // ===== G√äNEROS =====
        function getGenres() {
            const genreCount = {};
            books.filter(b => !b.s).forEach(book => {
                book.g.forEach(genre => {
                    genreCount[genre] = (genreCount[genre] || 0) + 1;
                });
            });
            return Object.entries(genreCount).sort((a, b) => b[1] - a[1]);
        }

        function renderGenreFilters() {
            const genres = getGenres();
            const availableBooks = books.filter(b => !b.s);
            
            genreFiltersContainer.innerHTML = `
                <button class="filter-chip ${activeGenres.length === 0 ? 'active' : ''}" onclick="setGenreFilter(null)">
                    <i class="fas fa-layer-group"></i>
                    <span>Todos</span>
                    <span class="count">${availableBooks.length}</span>
                </button>
                ${genres.map(([genre, count]) => `
                    <button class="filter-chip ${activeGenres.includes(genre) ? 'active' : ''}" onclick="setGenreFilter('${genre.replace(/'/g, "\\'")}')">
                        <span>${genre}</span>
                        <span class="count">${count}</span>
                    </button>
                `).join('')}
            `;
            setTimeout(updateFilterNavigation, 100);
        }

        function setGenreFilter(genre) {
            if (genre === null) {
                activeGenres = [];
            } else {
                const idx = activeGenres.indexOf(genre);
                if (idx > -1) {
                    activeGenres.splice(idx, 1);
                } else {
                    activeGenres.push(genre);
                }
            }
            renderGenreFilters();
            renderBooks();
        }

        // ===== NAVEGA√á√ÉO DOS FILTROS =====
        function updateFilterNavigation() {
            const container = document.querySelector('.filters-container');
            const scroll = document.querySelector('.filters-scroll');
            const prevBtn = document.getElementById('filterPrev');
            const nextBtn = document.getElementById('filterNext');
            
            if (!container || !scroll) return;
            
            const scrollWidth = scroll.scrollWidth;
            const containerWidth = container.offsetWidth;
            const maxScroll = scrollWidth - containerWidth;
            
            prevBtn.classList.toggle('visible', filterScrollPos > 0);
            nextBtn.classList.toggle('visible', filterScrollPos < maxScroll - 10);
        }

        function scrollFilters(direction) {
            const container = document.querySelector('.filters-container');
            const scroll = document.querySelector('.filters-scroll');
            
            const scrollAmount = 200;
            const scrollWidth = scroll.scrollWidth;
            const containerWidth = container.offsetWidth;
            const maxScroll = scrollWidth - containerWidth;
            
            filterScrollPos += direction * scrollAmount;
            filterScrollPos = Math.max(0, Math.min(filterScrollPos, maxScroll));
            
            scroll.style.transform = `translateX(-${filterScrollPos}px)`;
            updateFilterNavigation();
        }

        // ===== FAVORITOS =====
        function toggleFavorite(index, event) {
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            const idx = favorites.indexOf(index);
            if (idx > -1) {
                favorites.splice(idx, 1);
                showToast('Removido dos favoritos');
            } else {
                favorites.push(index);
                showToast('Adicionado aos favoritos', 'success');
            }
            
            localStorage.setItem('seboFavorites', JSON.stringify(favorites));
            updateFavoritesCount();
            
            const btn = document.querySelector(`[data-favorite-index="${index}"]`);
            if (btn) {
                btn.classList.toggle('active', favorites.includes(index));
                btn.querySelector('i').className = favorites.includes(index) ? 'fas fa-heart' : 'far fa-heart';
            }
            
            if (showOnlyFavorites) renderBooks();
        }

        function updateFavoritesCount() {
            document.getElementById('favoritesCount').textContent = favorites.length;
        }

        function toggleFavoritesFilter() {
            showOnlyFavorites = !showOnlyFavorites;
            document.getElementById('favoritesFilter').classList.toggle('active', showOnlyFavorites);
            document.getElementById('favoritesFilter').setAttribute('aria-pressed', showOnlyFavorites);
            renderBooks();
        }

        // ===== BUSCA DE CAPAS =====
        const coverCache = new Map();
        async function fetchCover(query, imgElement, bookTitle) {
            if (imgElement.dataset.customImg) {
                applyImage(imgElement, imgElement.dataset.customImg);
                return;
            }

            if (coverCache.has(query)) {
                applyImage(imgElement, coverCache.get(query));
                return;
            }

            try {
                const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=3&langRestrict=pt`);
                const data = await res.json();
                
                if (data.items && data.items.length > 0) {
                    let bestMatch = data.items[0];
                    const normalizedTitle = normalizeText(bookTitle);
                    
                    for (const item of data.items) {
                        const itemTitle = normalizeText(item.volumeInfo.title || '');
                        if (itemTitle.includes(normalizedTitle.split(' ')[0])) {
                            bestMatch = item;
                            break;
                        }
                    }
                    
                    if (bestMatch.volumeInfo.imageLinks) {
                        let url = bestMatch.volumeInfo.imageLinks.thumbnail || bestMatch.volumeInfo.imageLinks.smallThumbnail;
                        url = url.replace('http:', 'https:').replace('&zoom=1', '&zoom=0').replace('&edge=curl', '');
                        
                        coverCache.set(query, url);
                        applyImage(imgElement, url);
                        return;
                    }
                }
                throw new Error('No image');
            } catch (e) {
                showPlaceholder(imgElement, bookTitle);
            }
        }

        function applyImage(imgElement, url) {
            if (!imgElement) return;
            imgElement.src = url;
            imgElement.onload = () => {
                imgElement.classList.add('loaded');
                imgElement.parentElement?.classList.remove('skeleton');
            };
            imgElement.onerror = () => showPlaceholder(imgElement, imgElement.alt);
        }

        function showPlaceholder(imgElement, bookTitle) {
            if (!imgElement) return;
            const container = imgElement.parentElement;
            if (container) {
                container.classList.remove('skeleton');
                const shortTitle = bookTitle.length > 40 ? bookTitle.substring(0, 40) + '...' : bookTitle;
                container.innerHTML = `
                    <div class="cover-placeholder">
                        <i class="fas fa-book"></i>
                        <span>${shortTitle}</span>
                    </div>
                `;
            }
        }

        // ===== INTERSECTION OBSERVER =====
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    const query = img.dataset.query;
                    const title = img.dataset.title;
                    if (query) {
                        fetchCover(query, img, title);
                        imageObserver.unobserve(img);
                    }
                }
            });
        }, { rootMargin: '100px' });

        // ===== FORMATA√á√ÉO DA DESCRI√á√ÉO =====
        function formatDescription(text) {
            const sections = text.split('\n\n');
            let html = '';
            
            sections.forEach(section => {
                if (!section.trim()) return;
                
                let processed = section
                    .replace(/üìö|‚ú®|üìñ|‚ö†Ô∏è|üí∞|üéÅ/g, '')
                    .trim();
                
                if (processed.match(/^(Sobre|Conte√∫do|Volumes|Estado|Observa√ß√£o|Para quem|Diferencial|B√¥nus|Livros|Valor|T√≠tulos)/i)) {
                    const parts = processed.split(':');
                    if (parts.length > 1) {
                        const label = parts[0].trim();
                        const content = parts.slice(1).join(':').trim();
                        html += `<div class="section"><span class="label">${label}</span><br>${formatContent(content)}</div>`;
                    } else {
                        html += `<div class="section">${formatContent(processed)}</div>`;
                    }
                } else {
                    html += `<div class="section">${formatContent(processed)}</div>`;
                }
            });
            
            return html;
        }

        function formatContent(text) {
            return text
                .replace(/‚Ä¢/g, '<br>‚Ä¢')
                .replace(/\n/g, '<br>')
                .replace(/"([^"]+)"/g, '<span class="highlight">"$1"</span>')
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
        }

        // ===== RENDERIZA√á√ÉO =====
        function renderBooks() {
            grid.innerHTML = "";
            const searchTerm = normalizeText(searchInput.value);
            const sortMode = document.getElementById('sortSelect').value;

            let filtered = books.map((book, index) => ({ ...book, originalIndex: index }));

            const soldBooks = filtered.filter(b => b.s);
            let availableBooks = filtered.filter(b => !b.s);

            if (showOnlyFavorites) {
                availableBooks = availableBooks.filter(b => favorites.includes(b.originalIndex));
            }

            if (activeGenres.length > 0) {
                availableBooks = availableBooks.filter(b => 
                    activeGenres.some(genre => b.g.includes(genre))
                );
            }

            if (searchTerm) {
                availableBooks = availableBooks.filter(b => 
                    normalizeText(b.t).includes(searchTerm) || 
                    normalizeText(b.d).includes(searchTerm) ||
                    b.g.some(genre => normalizeText(genre).includes(searchTerm))
                );
            }

            if (sortMode === 'price-asc') availableBooks.sort((a, b) => a.v - b.v);
            if (sortMode === 'price-desc') availableBooks.sort((a, b) => b.v - a.v);
            if (sortMode === 'alpha') availableBooks.sort((a, b) => a.t.localeCompare(b.t));

            const total = availableBooks.length;
            counter.textContent = `${total} ${total === 1 ? 'livro dispon√≠vel' : 'livros dispon√≠veis'}`;
            
            emptyState.classList.toggle('hidden', total > 0 || soldBooks.length > 0);
            grid.classList.toggle('hidden', total === 0 && soldBooks.length === 0);
            
            availableBooks.forEach((book, idx) => renderCard(book, idx, false));
            
            if (!searchTerm && activeGenres.length === 0 && !showOnlyFavorites) {
                soldBooks.forEach((book, idx) => renderCard(book, availableBooks.length + idx, true));
            }
        }

        function renderCard(book, idx, isSold) {
            const isFavorite = favorites.includes(book.originalIndex);
            
            let priceHtml = '';
            if (book.op && !isSold) {
                const discount = Math.round(((book.op - book.v) / book.op) * 100);
                // AQUI EST√Å A CORRE√á√ÉO DE PRE√áO:
                // Usamos 'flex-col' para o container geral (pre√ßo original em cima)
                // E 'flex whitespace-nowrap' para o pre√ßo verde + desconto ficarem na mesma linha
                priceHtml = `
                    <div class="flex flex-col items-start w-full">
                        <span class="price-original text-xs mb-0.5">R$ ${book.op.toFixed(2).replace('.', ',')}</span>
                        <div class="flex items-center whitespace-nowrap">
                            <span class="font-bold text-lg current-price-green mr-2">R$ ${book.p}</span>
                            <span class="discount-badge text-[10px]">-${discount}%</span>
                        </div>
                    </div>
                `;
            } else {
                priceHtml = `<span class="font-bold text-lg" style="color: ${isSold ? 'var(--color-text-muted)' : 'var(--color-accent)'}; ${isSold ? 'text-decoration: line-through;' : ''}">R$ ${book.p}</span>`;
            }

            const card = document.createElement('article');
            card.className = `book-card ${isSold ? 'sold' : ''}`;
            card.style.animationDelay = `${idx * 50}ms`;
            
            card.innerHTML = `
                ${isSold ? '<div class="sold-badge"><span>Vendido</span></div>' : ''}
                <div class="book-cover skeleton">
                    <img data-query="${book.q}" 
                         data-title="${book.t}" 
                         ${book.img ? `data-custom-img="${book.img}"` : ''}
                         alt="Capa: ${book.t}" 
                         loading="lazy">
                    ${!isSold ? `
                        <button class="favorite-btn ${isFavorite ? 'active' : ''}" 
                                data-favorite-index="${book.originalIndex}"
                                onclick="toggleFavorite(${book.originalIndex}, event)"
                                aria-label="${isFavorite ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}">
                            <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
                        </button>
                    ` : ''}
                </div>
                <div class="p-4 sm:p-5 flex-1 flex flex-col">
                    <div class="genre-tags mb-2">
                        ${book.g.map(genre => `<span class="genre-tag">${genre}</span>`).join('')}
                    </div>
                    <h2 class="font-display font-bold text-base sm:text-lg leading-tight mt-2 mb-3 line-clamp-2" style="color: var(--color-primary);">${book.t}</h2>
                    
                    <div class="mt-auto pt-3 border-t flex justify-between items-center" style="border-color: var(--color-border);">
                        ${priceHtml}
                        ${!isSold ? `
                            <div class="h-8 w-8 rounded-full flex items-center justify-center transition" style="background: var(--color-surface-elevated);">
                                <i class="fas fa-arrow-right text-xs" style="color: var(--color-text-muted);"></i>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            if (!isSold) {
                card.addEventListener('click', () => openModal(book));
                card.style.cursor = 'pointer';
            }
            
            grid.appendChild(card);
            
            const img = card.querySelector('img');
            if (img) imageObserver.observe(img);

            requestAnimationFrame(() => {
                setTimeout(() => card.classList.add('visible'), idx * 50);
            });
        }

        // ===== MODAIS =====
        function openModal(book) {
            const isFavorite = favorites.includes(book.originalIndex);
            
            closeModal();
            
            setTimeout(() => {
                document.getElementById('modalTitle').textContent = book.t;
                
                const priceContainer = document.getElementById('modalPriceContainer');
                if (book.op) {
                    const discount = Math.round(((book.op - book.v) / book.op) * 100);
                    priceContainer.innerHTML = `
                         <span class="price-original" style="display:inline-block; margin-right: 8px;">R$ ${book.op.toFixed(2).replace('.', ',')}</span>
                         <span class="current-price-green text-2xl font-bold">R$ ${book.p}</span>
                         <span class="discount-badge text-sm ml-2">-${discount}% OFF</span>
                    `;
                } else {
                    priceContainer.innerHTML = `<span class="current-price-green text-2xl font-bold">R$ ${book.p}</span>`;
                }

                document.getElementById('modalDesc').innerHTML = formatDescription(book.d);
                
                document.getElementById('modalGenreTags').innerHTML = book.g.map(genre => 
                    `<span class="genre-tag">${genre}</span>`
                ).join('');

                const modalImg = document.getElementById('modalImg');
                modalImg.alt = `Capa: ${book.t}`;
                
                if (book.img) {
                    modalImg.src = book.img;
                } else if (coverCache.has(book.q)) {
                    modalImg.src = coverCache.get(book.q);
                } else {
                    modalImg.src = '';
                    fetchCover(book.q, modalImg, book.t);
                }

                const modalFavBtn = document.getElementById('modalFavoriteBtn');
                modalFavBtn.classList.toggle('active', isFavorite);
                modalFavBtn.querySelector('i').className = isFavorite ? 'fas fa-heart' : 'far fa-heart';
                
                modalFavBtn.onclick = (e) => {
                    toggleFavorite(book.originalIndex, e);
                    modalFavBtn.classList.toggle('active', favorites.includes(book.originalIndex));
                    modalFavBtn.querySelector('i').className = favorites.includes(book.originalIndex) ? 'fas fa-heart' : 'far fa-heart';
                };

                const msg = encodeURIComponent(`Ol√° Rodrigo! üìö\n\nTenho interesse no livro:\n*${book.t}*\nValor: R$ ${book.p}\n\nAinda est√° dispon√≠vel?`);
                document.getElementById('modalWhatsapp').href = `https://wa.me/5547991438831?text=${msg}`;
                
                document.getElementById('modalBackdrop').classList.add('open');
                document.getElementById('modal').classList.add('open');
                document.body.style.overflow = 'hidden';
            }, 50);
        }

        function closeModal() {
            document.getElementById('modalBackdrop').classList.remove('open');
            document.getElementById('modal').classList.remove('open');
            document.body.style.overflow = '';
        }

        function openHowItWorks() {
            document.getElementById('howItWorksBackdrop').classList.add('open');
            document.getElementById('howItWorksModal').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeHowItWorks() {
            document.getElementById('howItWorksBackdrop').classList.remove('open');
            document.getElementById('howItWorksModal').classList.remove('open');
            document.body.style.overflow = '';
        }

        function openPaymentInfo() {
            document.getElementById('paymentBackdrop').classList.add('open');
            document.getElementById('paymentModal').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closePaymentInfo() {
            document.getElementById('paymentBackdrop').classList.remove('open');
            document.getElementById('paymentModal').classList.remove('open');
            document.body.style.overflow = '';
        }

        // ===== UTILIT√ÅRIOS =====
        function copyPix() {
            navigator.clipboard.writeText("58242143000190").then(() => {
                showToast('Chave Pix copiada!', 'success');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = '58242143000190';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('Chave Pix copiada!', 'success');
            });
        }

        function clearSearch() {
            searchInput.value = '';
            clearSearchBtn.classList.remove('visible');
            renderBooks();
            searchInput.focus();
        }

        function clearAllFilters() {
            searchInput.value = '';
            clearSearchBtn.classList.remove('visible');
            activeGenres = [];
            showOnlyFavorites = false;
            document.getElementById('favoritesFilter').classList.remove('active');
            document.getElementById('favoritesFilter').setAttribute('aria-pressed', 'false');
            renderGenreFilters();
            renderBooks();
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('menu-open');
        }

        function showToast(message, type = 'default') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>

